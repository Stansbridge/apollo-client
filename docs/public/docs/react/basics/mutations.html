<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <!-- Basic -->
    <title>Mutations | Apollo Client Guide</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png" sizes="16x16 32x32 64x64">

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.apollographql.com/docs/react">
    <meta property="og:title" content="Mutations | Apollo Client Guide">
    <meta property="og:description" content="">
    <meta property="og:image" content="">
    <meta name="twitter:card" content="summary_image_large">
    <meta name="twitter:site" content="@apollographql">
    <meta name="twitter:title" content="Mutations | Apollo Client Guide">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/docs/react/style/style.css">
  </head>
  <body class="">
    

<div class="nav dark">
  <div class="nav-group">
    <div class="nav-item show-mobile">
      <span class="js-sidebar-toggle ">
        <span class="icon-menu"></span>
      </span>
    </div>
    <div class="nav-item">
      
      <a class="logo-wrapper" href="http://dev.apollodata.com/" title="Apollo Developers"  >
        <img src="../images/logo-apollo-space-left.svg" alt="Apollo" class="logo"/><img src="../images/logo-apollo-subbrands-developers-space.svg" class="logo-subbrand" alt="Developers"/>
      </a>
    </div>
  </div>

  <div class="nav-group right">
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/react"  >
          <span>React</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/angular2"  >
          <span>Angular</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/ios"  >
          <span>iOS</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/android"  >
          <span>Android</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/core"  >
          <span>Vanilla JS</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false separator">
        <a class="link" href="http://dev.apollodata.com/tools"  >
          <span>Server</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="https://medium.com/apollo-stack" target=_new >
          <span>Blog</span>
        </a>
      </div>
    
      
      <div class="nav-item show-desktop false ">
        <a class="link" href="http://dev.apollodata.com/community"  >
          <span>Community</span>
        </a>
      </div>
    
  </div>
</div>

<div class="sidebar">
  <div class="panel">
    <div class="panel-item">
      <a class="" href="../http:/dev.apollodata.com/" title="Apollo"  >
        <span>Apollo Developers</span>
      </a>
    </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/react"  >
          <span>React</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/angular2"  >
          <span>Angular</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/ios"  >
          <span>iOS</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/android"  >
          <span>Android</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/core"  >
          <span>Vanilla JS</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/tools"  >
          <span>Server</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="https://medium.com/apollo-stack" target=_new >
          <span>Blog</span>
        </a>
      </div>
    
      <div class="panel-item "">
        <a class="" href="http://dev.apollodata.com/community"  >
          <span>Community</span>
        </a>
      </div>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Apollo Client Guide</span>
      
    </div>

    

    <ul class="toc">
      
        <li>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="../index.html" class="sidebar-link ">
                  <span>Apollo Client</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="integrations.html" class="sidebar-link ">
                  <span>View Integrations</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="setup.html" class="sidebar-link ">
                  <span>Setup and options</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="queries.html" class="sidebar-link ">
                  <span>Queries</span>
                </a>
              </li>
            
              
              <li class="item-toc  current">
                <a href="" class="sidebar-link  current">
                  <span>Mutations</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="network-layer.html" class="sidebar-link ">
                  <span>Network layer</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="error-handling.html" class="sidebar-link ">
                  <span>Error Handling</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="fragments.html" class="sidebar-link ">
                  <span>Using Fragments</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="subscriptions.html" class="sidebar-link ">
                  <span>Subscriptions</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Features</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="../features/changelog.html" class="sidebar-link ">
                  <span>Changelog</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../features/caching.html" class="sidebar-link ">
                  <span>Direct Cache Access</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../features/developer-tooling.html" class="sidebar-link ">
                  <span>Developer tools</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../features/network-customization.html" class="sidebar-link ">
                  <span></span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../features/optimistic-ui.html" class="sidebar-link ">
                  <span>Optimistic UI</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../features/react-native.html" class="sidebar-link ">
                  <span>Integrating with React Native</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../features/static-typing.html" class="sidebar-link ">
                  <span>Using TypeScript and Flow</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Recipes</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="../recipes/authentication.html" class="sidebar-link ">
                  <span>Authentication</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../recipes/babel.html" class="sidebar-link ">
                  <span>Precompilation with babel</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../recipes/meteor.html" class="sidebar-link ">
                  <span>Meteor</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../recipes/pagination.html" class="sidebar-link ">
                  <span>Pagination</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../recipes/prefetching.html" class="sidebar-link ">
                  <span>Prefetching data</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../recipes/query-splitting.html" class="sidebar-link ">
                  <span>Query Splitting</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../recipes/server-side-rendering.html" class="sidebar-link ">
                  <span>Server Side Rendering</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../recipes/simple-example.html" class="sidebar-link ">
                  <span>Small Example: Snack</span>
                </a>
              </li>
            
              
              <li class="item-toc ">
                <a href="../recipes/webpack.html" class="sidebar-link ">
                  <span>Webpack loader</span>
                </a>
              </li>
            
          </ul>
        </li>
      
        <li>
          
            <div class="heading-toc">Reference</div>
          
          <ul class="list-toc">
            
              
              <li class="item-toc ">
                <a href="../reference/index.html" class="sidebar-link ">
                  <span>Title</span>
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>
  </div>
</div>

<div class="content">
  <div class="content-wrapper">
    <div class="header-content">
      <h1 class="title-page">Mutations</h1>
      

      <div class="page-actions">
        <div class="actions-group">
          <a class="btn tertiary small round lowercase" href="https://github.com/apollographql/apollo-client/tree/master/docs/source/basics/mutations.md" target="_blank"><span class="icon-github"></span> <span>Edit on GitHub</span></a>
          
          
        </div>
      </div>
    </div>

    <div class="document-formatting">
      <p>In addition to fetching data using queries, Apollo also helps you handle GraphQL mutations. In GraphQL, mutations are identical to queries in syntax, the only difference being that you use the keyword <code>mutation</code> instead of <code>query</code> to indicate that the root fields on this query are going to be performing writes to the backend.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mutation &#123;</div><div class="line">  submitRepository(repoFullName: <span class="string">"apollographql/apollo-client"</span>) &#123;</div><div class="line">    id</div><div class="line">    repoName</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>GraphQL mutations represent two things in one query string:</p>
<ol>
<li>The mutation field name with arguments, <code>submitRepository</code>, which represents the actual operation to be done on the server.</li>
<li>The fields you want back from the result of the mutation to update the client, in this case <code>{ id, repoName }</code>.</li>
</ol>
<p>The above mutation will submit a new GitHub repository to GitHunt, saving an entry to the database. The result might be:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"data"</span>: &#123;</div><div class="line">    <span class="attr">"submitRepository"</span>: &#123;</div><div class="line">      <span class="attr">"id"</span>: <span class="string">"123"</span>,</div><div class="line">      <span class="attr">"repoName"</span>: <span class="string">"apollographql/apollo-client"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>When we use mutations in Apollo, the result is typically integrated into the cache automatically <a href="cache-updates.html#dataIdFromObject">based on the id of the result</a>, which in turn updates the UI automatically, so we often don’t need to explicitly handle the results. In order for the client to correctly do this, we need to ensure we select the necessary fields in the result. One good strategy can be to simply ask for any fields that might have been affected by the mutation. Alternatively, you can use <a href="fragments.html">fragments</a> to share the fields between a query and a mutation that updates that query.</p>
<h2 id="basics">Basic mutations</h2>

<p>Using <code>graphql</code> with mutations makes it easy to bind actions to your components. Unlike queries, which provide a complicated object with lots of metadata and methods, mutations provide only a simple function to the wrapped component, in a prop called <code>mutate</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; graphql &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</div><div class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewEntry</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123; ... &#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> submitRepository = gql<span class="string">`</span></div><div class="line"><span class="string">  mutation submitRepository &#123;</span></div><div class="line"><span class="string">    submitRepository(repoFullName: "apollographql/apollo-client") &#123;</span></div><div class="line"><span class="string">      createdAt</span></div><div class="line"><span class="string">    &#125;</span></div><div class="line"><span class="string">  &#125;</span></div><div class="line"><span class="string">`</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> NewEntryWithData = graphql(submitRepository)(NewEntry);</div></pre></td></tr></table></figure>
<p>The component created above will recieve a prop called <code>mutate</code> which is a function that returns a promise of the mutation result.</p>
<h2 id="calling-mutations">Calling mutations</h2>

<p>Most mutations will require arguments in the form of query variables, and you may wish to also provide other options as well. <a href="#graphql-mutation-options">See the complete set of mutation options in the API docs.</a></p>
<p>The simplest option is to directly pass options to the default <code>mutate</code> prop when you call it in the wrapped component:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; gql, graphql &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewEntry</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  onClick() &#123;</div><div class="line">    <span class="keyword">this</span>.props.mutate(&#123;</div><div class="line">      variables: &#123; <span class="attr">repoFullName</span>: <span class="string">'apollographql/apollo-client'</span> &#125;</div><div class="line">    &#125;)</div><div class="line">      .then(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'got data'</span>, data);</div><div class="line">      &#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'there was an error sending the query'</span>, error);</div><div class="line">      &#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onClick.bind(this)&#125;</span>&gt;</span>Click me<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> submitRepository = gql<span class="string">`</span></div><div class="line"><span class="string">  mutation submitRepository($repoFullName: String!) &#123;</span></div><div class="line"><span class="string">    submitRepository(repoFullName: $repoFullName) &#123;</span></div><div class="line"><span class="string">      createdAt</span></div><div class="line"><span class="string">    &#125;</span></div><div class="line"><span class="string">  &#125;</span></div><div class="line"><span class="string">`</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> NewEntryWithData = graphql(submitRepository)(NewEntry);</div></pre></td></tr></table></figure>
<h3 id="custom-arguments">Custom arguments</h3>

<p>While the above approach with the default prop works just fine, typically you’d want to keep the concern of formatting the mutation options out of your presentational component. The best way to do this is to use the <a href="setup.html#graphql-config-props"><code>props</code></a> config to wrap the mutation in a function that accepts exactly the arguments it needs:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> NewEntryWithData = graphql(submitRepository, &#123;</div><div class="line">  props: <span class="function">(<span class="params">&#123; mutate &#125;</span>) =&gt;</span> (&#123;</div><div class="line">    submit: <span class="function">(<span class="params">repoFullName</span>) =&gt;</span> mutate(&#123; <span class="attr">variables</span>: &#123; repoFullName &#125; &#125;),</div><div class="line">  &#125;),</div><div class="line">&#125;)(NewEntry);</div></pre></td></tr></table></figure>
<p>Here’s that in context with a component, which can now be much simpler because it just needs to pass one argument:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; gql, graphql &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> NewEntry = <span class="function">(<span class="params">&#123; submit &#125;</span>) =&gt;</span> (</div><div class="line">  &lt;div onClick=&#123;() =&gt; submit(<span class="string">'apollographql/apollo-client'</span>)&#125;&gt;</div><div class="line">    Click me</div><div class="line">  &lt;<span class="regexp">/div&gt;</span></div><div class="line"><span class="regexp">);</span></div><div class="line"><span class="regexp"></span></div><div class="line"><span class="regexp">const submitRepository = gql`...`; /</span><span class="regexp">/ Same query as above</span></div><div class="line"><span class="regexp"></span></div><div class="line"><span class="regexp">const NewEntryWithData = graphql(submitRepository, &#123;</span></div><div class="line"><span class="regexp">  props: (&#123; mutate &#125;) =&gt; (&#123;</span></div><div class="line"><span class="regexp">    submit: (repoFullName) =&gt; mutate(&#123; variables: &#123; repoFullName &#125; &#125;),</span></div><div class="line"><span class="regexp">  &#125;),</span></div><div class="line"><span class="regexp">&#125;)(NewEntry);</span></div></pre></td></tr></table></figure>
<p>Note that, in general, you don’t need to use the results from the mutation callback directly. Instead you should usually rely on Apollo’s id-based cache updating to take care of it for you. If that doesn’t cover your needs, there are <a href="cache-updates.html">several different options for updating the store after a mutation</a>. That way, you can keep your UI components as stateless and declarative as possible.</p>
<h2 id="multiple-mutations">Multiple mutations</h2>

<p>If you need more than one mutation on a component, you make a graphql container for each:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> ComponentWithMutations =</div><div class="line">  graphql(submitNewUser, &#123; <span class="attr">name</span>: <span class="string">'newUserMutation'</span> &#125;)(</div><div class="line">    graphql(submitRepository, &#123; <span class="attr">name</span>: <span class="string">'newRepositoryMutation'</span> &#125;)(Component)</div><div class="line">  )</div></pre></td></tr></table></figure>
<p>Make sure to use the <a href="setup#graphql-config-name"><code>name</code> option on the <code>graphql()</code> container</a> to name the provided prop, so that the two containers don’t both try to name their function <code>mutate</code>.</p>
<p>If you want a better syntax for the above, consider using <a href="setup#compose"><code>compose</code></a>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; compose &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> ComponentWithMutations = compose(</div><div class="line">  graphql(submitNewUser, &#123; <span class="attr">name</span>: <span class="string">'newUserMutation'</span> &#125;),</div><div class="line">  graphql(submitRepository, &#123; <span class="attr">name</span>: <span class="string">'newRepositoryMutation'</span> &#125;)</div><div class="line">)(Component);</div></pre></td></tr></table></figure>
<p>This does the exact same thing as the previous snippet, but with a nicer syntax that flattens things out.</p>
<h2 id="optimistic-ui">Optimistic UI</h2>

<p>Sometimes your client code can easily predict the result of a successful mutation even before the server responds with the result. For instance, in GitHunt, when a user comments on a repository, we want to show the new comment in the UI immediately, without waiting on the latency of a round trip to the server, giving the user a faster UI experience. This is what we call <a href="optimistic-ui.html">Optimistic UI</a>. This is possible with Apollo if the client can predict an <em>optimistic response</em> for the mutation.</p>
<p>All you need to do is specify the <code>optimisticResponse</code> option. This “fake result” will be used to update active queries immediately, in the same way that the server’s mutation response would have done. The optimistic patches are stored in a separate place in the cache, so once the actual mutation returns, the relevant optimistic update is automatically thrown away and replaced with the real result.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; graphql &#125; <span class="keyword">from</span> <span class="string">'react-apollo'</span>;</div><div class="line"><span class="keyword">import</span> gql <span class="keyword">from</span> <span class="string">'graphql-tag'</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentPage</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123; ... &#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> submitComment = gql<span class="string">`</span></div><div class="line"><span class="string">  mutation submitComment($repoFullName: String!, $commentContent: String!) &#123;</span></div><div class="line"><span class="string">    submitComment(repoFullName: $repoFullName, commentContent: $commentContent) &#123;</span></div><div class="line"><span class="string">      postedBy &#123;</span></div><div class="line"><span class="string">        login</span></div><div class="line"><span class="string">        html_url</span></div><div class="line"><span class="string">      &#125;</span></div><div class="line"><span class="string">      createdAt</span></div><div class="line"><span class="string">      content</span></div><div class="line"><span class="string">    &#125;</span></div><div class="line"><span class="string">  &#125;</span></div><div class="line"><span class="string">`</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> CommentPageWithData = graphql(submitComment, &#123;</div><div class="line">  props: <span class="function">(<span class="params">&#123; ownProps, mutate &#125;</span>) =&gt;</span> (&#123;</div><div class="line">    submit: <span class="function">(<span class="params">&#123; repoFullName, commentContent &#125;</span>) =&gt;</span> mutate(&#123;</div><div class="line">      variables: &#123; repoFullName, commentContent &#125;,</div><div class="line"></div><div class="line">      optimisticResponse: &#123;</div><div class="line">        __typename: <span class="string">'Mutation'</span>,</div><div class="line">        submitComment: &#123;</div><div class="line">          __typename: <span class="string">'Comment'</span>,</div><div class="line">          <span class="comment">// Note that we can access the props of the container at `ownProps` if we</span></div><div class="line">          <span class="comment">// need that information to compute the optimistic response</span></div><div class="line">          postedBy: ownProps.currentUser,</div><div class="line">          createdAt: +<span class="keyword">new</span> <span class="built_in">Date</span>,</div><div class="line">          content: commentContent,</div><div class="line">        &#125;,</div><div class="line">      &#125;,</div><div class="line">    &#125;),</div><div class="line">  &#125;),</div><div class="line">&#125;)(CommentPage);</div></pre></td></tr></table></figure>
<p>For the example above, it is easy to construct an optimistic response, since we know the shape of the new comment and can approximately predict the created data. The optimistic response doesn’t have to be exactly correct because it will always will be replaced with the real result from the server, but it should be close enough to make users feel like there is no delay.</p>
<h2 id="mutation-results">Designing mutation results</h2>

<p>When people talk about GraphQL, they often focus on the data fetching side of things, because that’s where GraphQL brings the most value. Mutations can be pretty elegant if done well, but the principles of designing good mutations, and especially good mutation result types, are not yet well-understood in the open source community. So when you are working with mutations it might often feel like you need to make a lot of application-specific decisions.</p>
<p>In GraphQL, mutations can return any type, and that type can be queried just like a regular GraphQL query. So the question is - what type should a particular mutation return?</p>
<p>In most cases, the data available from a mutation result should be the server developer’s best guess of the data a client would need to understand what happened on the server. For example, a mutation that creates a new comment on a blog post might return the comment itself. A mutation that reorders an array might need to return the whole array.</p>
<h2 id="update-after-mutation">Store updates</h2>

<p>Most of the time it is not necessary to tell Apollo which parts of the cache to update, but if your mutation is creating a new object or deleting something, you will need to write some extra logic. Read about it in the <a href="cache-updates.html">article about updating the store</a>.</p>
<p>For more information about all of the options and features supported by React Apollo for GraphQL mutations be sure to review the <a href="api.html#mutations">API reference on <code>graphql()</code> mutations</a>.</p>
<h2 title="API Reference">API Reference</h2><br><h2 id="graphql-mutation-mutate"><code>props.mutate</code></h2>

<p>The higher order component created when you pass a mutation to <code>graphql()</code> will provide your component with a single prop named <code>mutate</code>. Unlike the <code>data</code> prop which you get when you pass a query to <code>graphql()</code>, <code>mutate</code> is a function.</p>
<p>The <code>mutate</code> function will actually execute your mutation using the network interface therefore mutating your data. The <code>mutate</code> function will also then update your cache in ways you define.</p>
<p>To learn more about how mutations work, be sure to check out the <a href="mutations.html">mutations usage documentation</a>.</p>
<p>The <code>mutate</code> function accepts the same options that <a href="#graphql-mutation-options"><code>config.options</code> for mutations</a> accepts, so to make sure to read through the documentation for that to know what you can pass into the <code>mutate</code> function.</p>
<p>The reason the <code>mutate</code> function accepts the same options is that it will use the options from <a href="#graphql-mutation-options"><code>config.options</code></a> <em>by default</em>. When you pass an object into the <code>mutate</code> function you are just overriding what is already in <a href="#graphql-mutation-options"><code>config.options</code></a>.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">&#123; mutate &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">      mutate(&#123;</div><div class="line">        variables: &#123; <span class="attr">foo</span>: <span class="number">42</span> &#125;,</div><div class="line">      &#125;);</div><div class="line">    &#125;&#125;&gt;</div><div class="line">      Mutate</div><div class="line">    &lt;<span class="regexp">/button&gt;</span></div><div class="line"><span class="regexp">  );</span></div><div class="line"><span class="regexp">&#125;</span></div><div class="line"><span class="regexp"></span></div><div class="line"><span class="regexp">export default graphql(gql`mutation &#123; ... &#125;`)(MyComponent);</span></div></pre></td></tr></table></figure>
<h2 id="graphql-mutation-options"><code>config.options</code></h2>

<p>An object or function that returns an object of options that are used to configure how the query is fetched and updated.</p>
<p>If <code>config.options</code> is a function then it will take the component’s props as its first argument.</p>
<p>The options available for use in this object depend on the operation type you pass in as the first argument to <code>graphql()</code>. The references below will document which options are availble when your operation is a mutation. To see what other options are available for different operations, see the generic documentation for <a href="#graphql-config-options"><code>config.options</code></a>.</p>
<p>The properties accepted in this options object may also be accepted by the <a href="#graphql-mutation-mutate"><code>props.mutate</code></a> function. Any options passed into the <code>mutate</code> function will take precedence over the options defined in the <code>config</code> object.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`mutation &#123; ... &#125;`</span>, &#123;</div><div class="line">  options: &#123;</div><div class="line">    <span class="comment">// Options go here.</span></div><div class="line">  &#125;,</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`mutation &#123; ... &#125;`</span>, &#123;</div><div class="line">  options: <span class="function">(<span class="params">props</span>) =&gt;</span> (&#123;</div><div class="line">    <span class="comment">// Options are computed from `props` here.</span></div><div class="line">  &#125;),</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">&#123; mutate &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">      mutate(&#123;</div><div class="line">        <span class="comment">// Options are component from `props` and component state here.</span></div><div class="line">      &#125;);</div><div class="line">    &#125;&#125;&gt;</div><div class="line">      Mutate</div><div class="line">    &lt;<span class="regexp">/button&gt;</span></div><div class="line"><span class="regexp">  )</span></div><div class="line"><span class="regexp">&#125;</span></div><div class="line"><span class="regexp"></span></div><div class="line"><span class="regexp">export default graphql(gql`mutation &#123; ... &#125;`)(MyComponent);</span></div></pre></td></tr></table></figure>
<h3 id="graphql-mutation-options-variables"><code>options.variables</code></h3>

<p>The variables which will be used to execute the mutation operation. These variables should correspond to the variables that your mutation definition accepts. If you define <code>config.options</code> as a function, or you pass variables into the <a href="#graphql-mutation-mutate"><code>props.mutate</code></a> function then you may compute your variables from props and component state.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`</span></div><div class="line"><span class="string">  mutation ($foo: String!, $bar: String!) &#123;</span></div><div class="line"><span class="string">    ...</span></div><div class="line"><span class="string">  &#125;</span></div><div class="line"><span class="string">`</span>, &#123;</div><div class="line">  options: <span class="function">(<span class="params">props</span>) =&gt;</span> (&#123;</div><div class="line">    variables: &#123;</div><div class="line">      foo: props.foo,</div><div class="line">      bar: props.bar,</div><div class="line">    &#125;,</div><div class="line">  &#125;),</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<h3 id="graphql-mutation-options-optimisticResponse"><code>options.optimisticResponse</code></h3>

<p>Often when you mutate data it is fairly easy to predict what the response of the mutation will be before asking your server. The optimistic response option allows you to make your mutations feel faster by simulating the result of your mutation in your UI before the mutation actually finishes.</p>
<p>To learn more about the benefits of optimistic data and how to use it be sure to read the recipe on <a href="optimistic-ui.html">Optimistic UI</a>.</p>
<p>This optimistic response will be used with <a href="#graphql-mutation-options-update"><code>options.update</code></a> and <a href="#graphql-mutation-options-updateQueries"><code>options.updateQueries</code></a> to apply an update to your cache which will be rolled back before applying the update from the actual response.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">&#123; newText, mutate &#125;</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;button onClick=&#123;() =&gt; &#123;</div><div class="line">      mutate(&#123;</div><div class="line">        variables: &#123;</div><div class="line">          text: newText,</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">// The optimistic response has all of the fields that are included in</span></div><div class="line">        <span class="comment">// the GraphQL mutation document below.</span></div><div class="line">        optimisticResponse: &#123;</div><div class="line">          createTodo: &#123;</div><div class="line">            id: <span class="number">-1</span>, <span class="comment">// A temporary id. The server decides the real id.</span></div><div class="line">            text: newText,</div><div class="line">            completed: <span class="literal">false</span>,</div><div class="line">          &#125;,</div><div class="line">        &#125;,</div><div class="line">      &#125;);</div><div class="line">    &#125;&#125;&gt;</div><div class="line">      Add Todo</div><div class="line">    &lt;<span class="regexp">/button&gt;</span></div><div class="line"><span class="regexp">  );</span></div><div class="line"><span class="regexp">&#125;</span></div><div class="line"><span class="regexp"></span></div><div class="line"><span class="regexp">export default graphql(gql`</span></div><div class="line"><span class="regexp">  mutation ($text: String!) &#123;</span></div><div class="line"><span class="regexp">    createTodo(text: $text) &#123;</span></div><div class="line"><span class="regexp">      id</span></div><div class="line"><span class="regexp">      text</span></div><div class="line"><span class="regexp">      completed</span></div><div class="line"><span class="regexp">    &#125;</span></div><div class="line"><span class="regexp">  &#125;</span></div><div class="line"><span class="regexp">`)(MyComponent);</span></div></pre></td></tr></table></figure>
<h3 id="graphql-mutation-options-update"><code>options.update</code></h3>

<p>This option allows you to update your store based on your mutation’s result. By default Apollo Client will update all of the overlapping nodes in your store. Anything that shares the same id as returned by the <code>dataIdFromObject</code> you defined will be updated with the new fields from your mutation results. However, sometimes this alone is not sufficient. Sometimes you may want to update your cache in a way that is dependent on the data currently in your cache. For these updates you may use an <code>options.update</code> function.</p>
<p><code>options.update</code> takes two arguments. The first is an instance of a <a href="../core/apollo-client-api.html#DataProxy"><code>DataProxy</code></a> object which has some methods which will allow you to interact with the data in your store. The second is the response from your mutation - either the optimistic response, or the actual response returned by your server.</p>
<p>In order to change the data in your store call methods on your <a href="../core/apollo-client-api.html#DataProxy"><code>DataProxy</code></a> instance like <a href="../core/apollo-client-api.html#DataProxy.writeQuery"><code>writeQuery</code></a> and <a href="../core/apollo-client-api.html#DataProxy.writeFragment"><code>writeFragment</code></a>. This will update your cache and reactively re-render any of your GraphQL components which are querying affected data.</p>
<p>To read the data from the store that you are changing, make sure to use methods on your <a href="../core/apollo-client-api.html#DataProxy"><code>DataProxy</code></a> like <a href="../core/apollo-client-api.html#DataProxy.readQuery"><code>readQuery</code></a> and <a href="../core/apollo-client-api.html#DataProxy.readFragment"><code>readFragment</code></a>.</p>
<p>For more information on updating your cache after a mutation with the <code>options.update</code> function make sure to read the <a href="../core/read-and-write.html#updating-the-cache-after-a-mutation">Apollo Client technical documentation on the subject</a>.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> query = gql<span class="string">`&#123; todos &#123; ... &#125; &#125;`</span></div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`</span></div><div class="line"><span class="string">  mutation ($text: String!) &#123;</span></div><div class="line"><span class="string">    createTodo(text: $text) &#123; ... &#125;</span></div><div class="line"><span class="string">  &#125;</span></div><div class="line"><span class="string">`</span>, &#123;</div><div class="line">  options: &#123;</div><div class="line">    update: <span class="function">(<span class="params">proxy, &#123; data: &#123; createTodo &#125; &#125;</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">const</span> data = proxy.readQuery(&#123; query &#125;);</div><div class="line">      data.todos.push(createTodo);</div><div class="line">      proxy.writeQuery(&#123; query, data &#125;);</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<h3 id="graphql-mutation-options-refetchQueries"><code>options.refetchQueries</code></h3>

<p>Sometimes when you make a mutation you also want to update the data in your queries so that your users may see an up-to-date user interface. There are more fine-grained ways to update the data in your cache which include <a href="#graphql-mutation-options-updateQueries"><code>options.updateQueries</code></a>, and <a href="#graphql-mutation-options-update"><code>options.update</code></a>. However, you can update the data in your cache more reliably at the cost of efficiency by using <code>options.refetchQueries</code>.</p>
<p><code>options.refetchQueries</code> will execute one or more queries using your network interface and will then normalize the results of those queries into your cache. Allowing you to potentially refetch queries you had fetched before, or fetch brand new queries.</p>
<p><code>options.refetchQueries</code> is an array of either strings or objects.</p>
<p>If <code>options.refetchQueries</code> is an array of strings then Apollo Client will look for any queries with the same names as the provided strings and will refetch those queries with their current variables. So for example if you have a GraphQL query component with a query named <code>Comments</code> (the query may look like: <code>query Comments { ... }</code>), and you pass an array of strings containing <code>Comments</code> to <code>options.refetchQueries</code> then the <code>Comments</code> query will be re-executed and when it resolves the latest data will be reflected in your UI.</p>
<p>If <code>options.refetchQueries</code> is an array of objects then the objects must have two properties:</p>
<ul>
<li><code>query</code>: Query is a required property that accepts a GraphQL query created with <code>graphql-tag</code>’s <code>gql</code> template string tag. It should contain a single GraphQL query operation that will be executed once the mutation has completed.</li>
<li><code>[variables]</code>: Is an optional object of variables that is required when <code>query</code> accepts some variables.</li>
</ul>
<p>If an array of objects with this shape is specified then Apollo Client will refetch these queries with their variables.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`mutation &#123; ... &#125;`</span>, &#123;</div><div class="line">  options: &#123;</div><div class="line">    refetchQueries: [</div><div class="line">      <span class="string">'CommentList'</span>,</div><div class="line">      <span class="string">'PostList'</span>,</div><div class="line">    ],</div><div class="line">  &#125;,</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; COMMENT_LIST_QUERY &#125; <span class="keyword">from</span> <span class="string">'../components/CommentList'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`mutation &#123; ... &#125;`</span>, &#123;</div><div class="line">  options: <span class="function">(<span class="params">props</span>) =&gt;</span> (&#123;</div><div class="line">    refetchQueries: [</div><div class="line">      &#123;</div><div class="line">        query: COMMENT_LIST_QUERY,</div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        query: gql<span class="string">`</span></div><div class="line"><span class="string">          query ($id: ID!) &#123;</span></div><div class="line"><span class="string">            post(id: $id) &#123;</span></div><div class="line"><span class="string">              commentCount</span></div><div class="line"><span class="string">            &#125;</span></div><div class="line"><span class="string">          &#125;</span></div><div class="line"><span class="string">        `</span>,</div><div class="line">        variables: &#123;</div><div class="line">          id: props.postID,</div><div class="line">        &#125;,</div><div class="line">      &#125;,</div><div class="line">    ],</div><div class="line">  &#125;),</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
<h3 id="graphql-mutation-options-updateQueries"><code>options.updateQueries</code></h3>

<p><strong>Note: We recommend using <a href="#graphql-mutation-options-update">update</a> instead of <code>updateQueries</code>.</strong></p>
<p>This option allows you to update your store based on your mutation’s result. By default Apollo Client will update all of the overlapping nodes in your store. Anything that shares the same id as returned by the <code>dataIdFromObject</code> you defined will be updated with the new fields from your mutation results. However, sometimes this alone is not sufficient. Sometimes you may want to update your cache in a way that is dependent on the data currently in your cache. For these updates you may use an <code>options.updateQueries</code> function.</p>
<p><code>options.updateQueries</code> takes an object where query names are the keys and reducer functions are the values. If you are familiar with Redux, defining your <code>options.updateQueries</code> reducers is very similar to defining your Redux reducers. The object looks something like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  Comments: <span class="function">(<span class="params">previousData, &#123; mutationResult, queryVariables &#125;</span>) =&gt;</span> nextData,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Make sure that the key of your <code>options.updateQueries</code> object corresponds to an actual query that you have made somewhere else in your app. The query name will be the name you put after specifying the <code>query</code> operation type. So for example in the following query:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">query Comments &#123;</div><div class="line">  entry(id: 5) &#123;</div><div class="line">    comments &#123;</div><div class="line">      ...</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The query name would be <code>Comments</code>. If you have not executed a GraphQL query with the name of <code>Comments</code> before somewhere in your application, then the reducer function will never be run by Apollo and the key/value pair in <code>options.updateQueries</code> will be ignored.</p>
<p>The first argument to the function you provide as the value for your object will be the previous data for your query. So if your key is <code>Comments</code> then the first argument will be the last data object that was returned for your <code>Comments</code> query, or the current object that is being rendered by any component using the <code>Comments</code> query.</p>
<p>The second argument to your function value will be an object with three properties:</p>
<ul>
<li><code>mutationResult</code>: The <code>mutationResult</code> property will represent the result of your mutation after hitting the server. If you provided an <a href="#graphql-mutation-options-optimisticResponse"><code>options.optimisticResponse</code></a> then <code>mutationResult</code> may be that object.</li>
<li><code>queryVariables</code>: The last set of variables that the query was executed with. This is helpful because when you specify the query name it will only update the data in the store for your current variable set.</li>
<li><code>queryName</code>: This is the name of the query you are updating. It is the same name as the key you provided to <code>options.updateQueries</code>.</li>
</ul>
<p>The return value of your <code>options.updateQueries</code> functions <em>must</em> have the same shape as your first <code>previousData</code> argument. However, you <em>must not</em> mutate the <code>previousData</code> object. Instead you must create a new object with your changes. Just like in a Redux reducer.</p>
<p>To learn more about <code>options.updateQueries</code> read our usage documentation on <a href="cache-updates.html#updateQueries">controlling the store with <code>updateQueries</code></a>.</p>
<p><strong>Example:</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> graphql(gql<span class="string">`</span></div><div class="line"><span class="string">  mutation ($text: String!) &#123;</span></div><div class="line"><span class="string">    submitComment(text: $text) &#123; ... &#125;</span></div><div class="line"><span class="string">  &#125;</span></div><div class="line"><span class="string">`</span>, &#123;</div><div class="line">  options: &#123;</div><div class="line">    updateQueries: &#123;</div><div class="line">      Comments: <span class="function">(<span class="params">previousData, &#123; mutationResult &#125;</span>) =&gt;</span> &#123;</div><div class="line">        <span class="keyword">const</span> newComment = mutationResult.data.submitComment;</div><div class="line">        <span class="comment">// Note how we return a new copy of `previousData` instead of mutating</span></div><div class="line">        <span class="comment">// it. This is just like a Redux reducer!</span></div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">          ...previousData,</div><div class="line">          entry: &#123;</div><div class="line">            ...previousData.entry,</div><div class="line">            comments: [newComment, ...previousData.entry.comments],</div><div class="line">          &#125;,</div><div class="line">        &#125;;</div><div class="line">      &#125;,</div><div class="line">    &#125;,</div><div class="line">  &#125;,</div><div class="line">&#125;)(MyComponent);</div></pre></td></tr></table></figure>
    </div>
  </div>

  <div class="pagination">
    <div class="content-wrapper">
      
      
        <a class="link primary prev"
          href="queries.html">
          <span class="icon-arrow-left-alt"></span>
          <span class="subtitle-pagination">Previous</span>
          Queries
        </a>
      
      
        <a class="link primary next"
          href="network-layer.html">
          <span class="subtitle-pagination">Next</span>
          Network layer
          <span class="icon-arrow-right-alt"></span>
        </a>
      
    </div>
  </div>

  <div class="github">
    <a class="link tertiary " href="https://github.com/apollographql/apollo-client/tree/master/docs/source/basics/mutations.md" target="_blank">
      <span class="icon-github"></span>Edit on GitHub</a>
  </div>

  
</div>

    <script src="/docs/react/script/smooth-scroll.min.js"></script>
    <script src="/docs/react/script/main.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

    <script>
      // nectar ninja
      (function(){
        var handle = '@meteorjs';
        var a = document.createElement('script');
        var m = document.getElementsByTagName('script')[0];
        a.async = 1;
        a.src = 'https://nectar.ninja/api/v1/' + handle.slice(1);
        m.parentNode.insertBefore(a, m);
      })();

     

      
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-PNFDVBB');
      

      
        // Segment Tracking
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.1.0";
        analytics.load("wgrIo8Bul0Ujl8USETG3DB6hONdy4kTg");
        analytics.page()
        }}();
      

      // search box
      

      
    </script>
  </body>
</html>
